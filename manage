#!/usr/bin/env bash

# <doc>
#
# _manage is a model for setting up shell programs that use
# subcommands.
#
# For more details on how to define your own commands look
# online at https://github.com/eitherlands/_manage
#
# </doc>

# Relative path to the user-defined commands directory
MANAGESCRIPTSDIRECTORY="script"

# Relative path to the _manage repository
MANAGEDIRECTORY="_manage"

# The _manage script filename
MANAGEINIT="manage"

#######################
MANAGEIMPORTS=("manage")
MANAGEPATH="${MANAGEDIRECTORY}"/"${MANAGEINIT}"

SELFDIRECTORY="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SELFINIT="$( basename "${BASH_SOURCE[0]}" )"
SELFPATH="${SELFDIRECTORY}"/"${SELFINIT}"
SELFOPWD=$PWD ; cd "${SELFDIRECTORY}" || exit

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]
then
    source "${MANAGEPATH}"
    _harvest "${SELFDIRECTORY%%/}"/"${MANAGESCRIPTSDIRECTORY%%/}"
    _usageHeaderPath "${SELFPATH}"

    _enableStrictMode
    _catchExceptions

    unset options
    unset OPTIND
    while getopts ":h:?v" options "$@"; do
        _flags "$options"
    done && shift $((OPTIND - 1))
    unset OPTIND
    unset options

    [ "$1" = "--" ] && shift
    _run "$@"
    cd "${SELFOPWD}" || exit
fi

